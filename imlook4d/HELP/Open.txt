<h1  id="top">Open </h1>
<HR></HR>

<!------------------->
	<P>
		Loads medical images in one of the formats:

		<UL>
			<LI> <B><a href="javascript:;" onclick="document.location.hash='DICOM';">DICOM</a> </B>

			<LI>  <B><a href="javascript:;" onclick="document.location.hash='ECAT';">Siemens/CTI ECAT 7</a></B> (.v)
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Analyze';">Analyze</a> </B> (.hdr, .img)
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Nifti';">Nifti</a> </B> (.nii, .hdr, .img)
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Freesurfer';">Freesurfer</a> </B> (.mgz, .mgh)
            <LI>  <B><a href="javascript:;" onclick="document.location.hash='ITK';">ITK</a> </B> (.mhd , and possibly .mha)
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='SHR';">Hamamatsu SHR-7700</a> </B> (.ima)
			<LI>  <B>Imlook4d state </B> (.mat) 
				 (as saved from menu "File/Save state" )
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Binary';">Binary</a> </B>
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Hermes';">Hermes</a>(as taken from CD cache) </B>
			<LI>  <B><a href="javascript:;" onclick="document.location.hash='Interfile';">Interfile</a></B>
		</UL>

		The program uses the appropriate file reader based on 1) extension, 2) DICOM header 3) Interfile header.  
		If neither of these match, the file is assumed to be binary.
	</P>


<h2><a id="DICOM">DICOM file opening</a></h2>
<!-------------------------------------->

<B>1. DICOM user interface</B>
	<P>DICOM files are opened by selecting a single DICOM file from a file browser.  
    </P><P>Only little-endian DICOM files are supported.  
    
    
    </P><P><B><I> a) One image in each file </I></B>
    </P><P>
		
        If the selected DICOM file consists of a single image (generally the case), 
        all the files in the directory of the selected file are opened.
        If more than one series is found, a selection dialog is shown.  Here the correct series can be selected. 
        
	<!-- </P><P>
		A dialog with a regular expression filter is opened.  The default is to open all files within the directory (filter&nbsp;"*").   
        All DICOM files matching the regular expression are read, scaled, and sorted as described in the following section.  
        Non-DICOM files are ignored.
    -->
    </P><P><B><I> b) Multiple images in the file </I></B>
	</P><P>
		If the selected DICOM file consists of multiple images (nuclear medicin), only this DICOM file is considered.  
	</P>

<B>2. DICOM opening  - supported formats</B>
<!---------------------------------------->
    <P>Non-compressed little-endian DICOM files are supported using basic Matlab. 
    </P><P>Compressed formats supported by Matlab Imaging Toolbox are opened, if Imaging Toolbox is installed </P>  

	
<B>4. DICOM opening  - how it works</B>
<!---------------------------------------->
	<P>
		DICOM files are separated into two parts, a header and an image part.  
		The assumption is that the last N bytes in the file is a single image, where N=2*pixels*pixels.
		The image data is scaled according to the DICOM tags 
			<U><SPAN title="Tag='0028', '1053'">Rescale Slope</SPAN></U>
		and
			<U><SPAN title="Tag='0028', '1052'">Rescale Intercept</SPAN></U>
	</P><P>

		The DICOM files are sorted in the below order, using the tags that are available: 
		<UL>
			<LI>  <U><SPAN title="Tag='0020', '000E'">Series instance UID</SPAN></U>
			<LI>  <U><SPAN title="Tag='0008', '0022'">Acquisition date</SPAN></U>
			<LI> <U><SPAN title="Tag='0008', '0032'">Acquisition time</SPAN></U>
			<LI> <U><SPAN title="Tag='0018', '1060'">Trigger time</SPAN></U>
			<LI>  <U><SPAN title="Tag='0054', '1300'">Frame reference time</SPAN></U>
			<LI>  <U><SPAN title="Tag='0020', '1041'">Slice location</SPAN></U>
			<LI>  <U><SPAN title="Tag='0020', '0013'">Instance number</SPAN></U>
		</UL>
	</P><P>
        The order of gated CT and MR are known to be hard to sort out.  
        The best solution is to sort these only on instance number.
        The program simply uses this fallback, whenever consecutive sorted images have the same slice location.
	</P><P>
		Finally, the number of frames are determined from the number of images with equal slice location,
		and the data is displayed.
	</P>

<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

<h2><a id="ECAT">Siemens ECAT file opening</a></h2>
<!------------------------>

	<P>
		Opens a .v file.  Images are sorted in time order, solving a rare problem where frame order is scrambled.   
	</P>


<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

 <h2><a id="Analyze">Analyze file opening</a></h2>
<!------------------------>

	<P>
		Opens a .hdr or .img file.  
	</P>

	<P>
		If a .sif file with the same name as the .hdr file exists, imlook4d takes the frame time information from this.<BR> 
		The .sif file contains one header row, and then one row per frame.<BR>
		These rows are organized in two columns with frame start and end times (in seconds from scan start), separated by space. 
        Two additional columns contain data that can be used as weighting factors for curve fits (see Turku PET center web site)
		</P>

	<P>	
        .sif files can be created from dynamic scans that contains time information (thus not Nifti).  
        A good work flow would be to create a typical .sif file from the original DICOM data, and reuse that
        for all subsequently created Nifti files (having the same dynamic scan protocol).  
    </P>


<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

<h2><a id="Nifti">Nifti file opening</a></h2>
<!------------------------>

	<P>
		Opens  .nii files (one binary file), or .img + .hdr (two files as in Analyze format).  
	</P>

	<P>
		If a .sif file with the same name exists, imlook4d takes the frame time information from this file.<BR> 
		See the Analyze section above for information about .sif files.
	</P>

		
<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

<h2><a id="Freesurfer">Freesurfer</a></h2>
<!------------------------>
	<P>
		Opens Freesurfer MGH files, and compressed MGZ files.  Requires that the Freesurfer Matlab tools is installed.  
	</P>

		
<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

 <h2><a id="SHR">Hamamatsu file opening</a></h2>
<!------------------------>

	<P>
		Hamamatsu SHR-7700 files are assumed to be 256*256 pixels.  
		The user selects a single .ima (or .ima_01) file.  
	</P><P>	
		All .ima_* files in the same directory are then read.	
		Scaling is performed by reading the scale factor from the .inf file in the same directory.
		Timing data is read from the .mon file in the same directory.

	</P>


		
<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

 <h2><a id="Binary">Binary file opening</a></h2>
<!------------------------>

	<P>
		If the file is not recognized, then it is assumed to be binary.  
	</P><P>	
		The following information has to be entered:
		<UL>
			<LI> Number of pixels in x-direction
			<LI> Number of pixels in y-direction
			<LI> Number of slices (you may use a formula here, see example below)
			<LI> Number of frames (here it may be convenient to use a formula)
			<LI> Byte order (b for big endian, and l for little endian)
			<LI> Number format (int16, float32, or any other format specified by MATLAB)
		</UL>
	</P><P>	
		The file is opened starting from first byte (no option to enter an offset)

	</P><P>	
        An example of using formulas for the number of frames is the case when the total number of images is displayed in the slices field (say 1269).
        If you know the scanner's number of slices (for instance 47) then you can create a dynamic scan by typing: <BR>
         47 into the <i>Number of slices</i> field. <BR>
         the text "1269/47" into the <i>Number of frames</i> field.

	</P>

		
<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

 <h2><a id="ITK">ITK file opening</a></h2>
<!------------------------>

	<P>
		Opens a file with the .mdh or .mda extension created by the ITK toolkit.  The binary opener is used internally.

	</P>

<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>



 <h2><a id="Hermes">Hermes file opening</a></h2>
<!------------------------>

	<P>
		If the file is recognized as Hermes, it will be treated as a DICOM file.  
		Hermes CD cache stores files in a near-DICOM format, excluding transfer syntax UID. 

	</P><P>	
		Read the information about opening DICOM above.
	</P>



		
<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

<h2><a id="Interfile">Interfile file opening</a></h2>
<!------------------------>

	<P>
		An interfile file has two parts, a header file and a binary image file. 
		The interfile header file is selected in the file opening dialog. 

	</P><P>	
		The image file defined by the header file is opened.

	</P><P>	
		Interfile support for dynamic sequences is not well defined.
	</P>

<a href="javascript:;" onclick="document.location.hash='top';">[top]</a>

